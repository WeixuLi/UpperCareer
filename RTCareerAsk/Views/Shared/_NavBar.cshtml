@{
    bool IsAuthorized = ViewBag.IsAuthorized != null ? Convert.ToBoolean(ViewBag.IsAuthorized) : false;
    bool IsAdmin = ViewBag.IsAdmin != null ? Convert.ToBoolean(ViewBag.IsAdmin) : false;
    RTCareerAsk.Models.UserInfoModel um = new RTCareerAsk.Models.UserInfoModel();

    if (IsAuthorized || (ViewBag.IsAuthorized == null && Session["UserInfo"] != null))
    {
        um = Session["UserInfo"] as RTCareerAsk.Models.UserInfoModel;

        IsAuthorized = true;
    }
}

<nav class="navbar navbar-default">
    <div class="container-fluid container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-2">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="@Url.Action("Index", "Home")" class="navbar-brand"><strong>upper<span style="color: #70BF40">career</span></strong></a>
            @Html.Hidden("UserID", um.UserID, new { id = "hdnUserID" })
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-2">
            @if (IsAdmin)
            {
                <ul class="nav navbar-nav">
                    <li><a href="#" id="btnBugReport" data-toggle="modal" data-target="#divModal">报错 <span class="sr-only">(current)</span></a></li>
                    <li class="@Html.IsSelected("Test")">@Html.ActionLink("报告列表", "Index", "Test")</li>
                </ul>
            }
            @if (IsAuthorized)
            {
                <ul class="nav navbar-nav navbar-right">
                    @*<li>
                        <a href="@Url.Action("Index", "User", new { id = um.UserID })" style="padding:7.5px 15px">
                            @Html.UpperPortrait(um.Portrait, PortraitSize.Small, new { id = "imgNavBarPortrait" })
                            @um.Name
                        </a>
                    </li>*@
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" style="padding: 7.5px 15px">
                            @Html.UpperPortrait(um.Portrait, PortraitSize.Small, new { id = "imgNavBarPortrait" })
                            @um.Name
                            <span class="caret" />
                        </a>
                        <ul class="dropdown-menu">
                            <li>@Html.ActionLink("个人主页", "Index", "User", new { id = um.UserID }, new { })</li>
                            <li>@Html.ActionLink("个人设置", "UserManage", "Account")</li>
                            <li>@Html.ActionLink("登出", "LogOff", "Account")</li>
                        </ul>

                    </li>
                    <li>
                        <a href="@Url.Action("Index", "Message")" style="padding:10.5px 15px">
                            <span data-toggle="tooltip" data-placement="bottom" title="消息">
                                <img src="~/Images/notification.png" alt="" class="nav-img" />
                                @if (um.NewMessageCount > 0)
                                {
                                    <span id="spnNewMsgCnt" class="badge">@(um.NewMessageCount)</span>
                                }
                            </span>
                            <span class="sr-only">(current)</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="btnPostQuestion" data-toggle="modal" data-target="#divModal" style="padding: 10.5px 15px">
                            <span data-toggle="tooltip" data-placement="bottom" title="提问" />
                            <img src="~/Images/post.png" alt="" class="nav-img" />
                        </a>
                    </li>
                </ul>
            }
            else
            {
                <ul class="nav navbar-nav navbar-right">
                    <li class="@Html.IsSelected("Account", "Login")">@Html.ActionLink("登录 / 注册", "Login", "Account", new { returnUrl = Request.Url.AbsolutePath }, new { })</li>
                </ul>                
            }
        </div>
    </div>
</nav>
<div id="divInfoLoading" class="alert-tag" style="display: none">
    <div class="alert alert-dismissible alert-info">
        <button type="button" class="close">&times;</button>
        <p>显示些没用的……</p>
    </div>
</div>
<div id="divInfoSuccess" class="alert-tag" style="display: none">
    <div class="alert alert-dismissible alert-success">
        <button type="button" class="close">&times;</button>
        <p>Well done!</p>
    </div>
</div>
<div id="divInfoError" class="alert-tag" style="display: none">
    <div class="alert alert-dismissible alert-danger">
        <button type="button" class="close">&times;</button>
        <p></p>
    </div>
</div>

<script src="~/Scripts/Upper/bug-report.js"></script>
